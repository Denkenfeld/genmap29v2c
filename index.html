<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ParadiseFinder 2025 ‚Äì Daten-Fokus & Ranking</title>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        :root {
            --neon-blue: #00c6ff;
            --neon-green: #0aff68;
            --bg-dark: #121220;
            --bg-glass: rgba(20, 30, 50, 0.95); 
            --border-glass: 1px solid rgba(0, 198, 255, 0.2);
            --font-main: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }

        /* Base Setup */
        * { box-sizing: border-box; }
        body { margin: 0; min-height: 100vh; background-color: var(--bg-dark); font-family: var(--font-main); color: #fff; padding: 20px; display: flex; gap: 30px; }
        
        /* Left Panel (Controls) */
        #panel-left { position: sticky; top: 20px; width: 400px; background: var(--bg-glass); border: var(--border-glass); border-radius: 16px; padding: 24px; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); max-height: 96vh; overflow-y: auto; flex-shrink: 0; }
        
        /* Right Panel (Ranking & Details) */
        #ranking-panel { flex-grow: 1; display: flex; gap: 30px; }
        #ranking-list-container { width: 450px; background: var(--bg-glass); border: var(--border-glass); border-radius: 16px; padding: 24px; max-height: 96vh; overflow-y: auto; }
        #panel-right { flex-grow: 1; background: var(--bg-glass); border: var(--border-glass); border-radius: 16px; padding: 24px; max-height: 96vh; overflow-y: auto; }

        /* General UI */
        h2 { margin: 0 0 15px 0; font-weight: 400; font-size: 18px; color: var(--neon-blue); text-transform: uppercase; letter-spacing: 2px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px; }
        h3 { font-size: 13px; color: #fff; margin-top: 15px; margin-bottom: 8px; text-transform: uppercase; letter-spacing: 1px; }

        /* Input Controls */
        label { display: flex; justify-content: space-between; font-size: 11px; margin-bottom: 4px; color: #aaa; }
        input[type=range] { width: 100%; -webkit-appearance: none; background: rgba(0,0,0,0.5); height: 3px; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; width: 12px; height: 12px; background: var(--neon-blue); border-radius: 50%; cursor: grab; box-shadow: 0 0 10px var(--neon-blue); }
        input[type=number] { width: 100%; background: rgba(0,0,0,0.4); border: 1px solid #444; color: #fff; padding: 6px; border-radius: 4px; font-size: 14px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }

        /* Ranking List */
        .ranking-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; margin-bottom: 6px; border-radius: 6px; cursor: pointer; transition: background 0.2s; font-size: 14px; background: rgba(0,0,0,0.3); border-left: 5px solid transparent; }
        .ranking-item:hover, .ranking-item.selected { background: rgba(0, 198, 255, 0.1); border-left-color: var(--neon-blue); }
        .score-indicator { width: 5px; height: 100%; margin-right: 10px; border-radius: 2px; }
        .rank-number { color: #666; width: 25px; font-size: 12px; font-weight: bold; }

        /* Detail View */
        .big-stat-box { background: rgba(0,198,255,0.05); border: 1px solid rgba(0,198,255,0.2); border-radius: 8px; padding: 20px; text-align: center; margin-bottom: 20px; }
        .stat-circle-score { font-size: 56px; font-weight: 300; display: block; text-shadow: 0 0 30px rgba(0,198,255,0.5); }
        .f-row { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 15px; }
        .cash-flow { font-size: 20px; font-weight: bold; margin-top: 10px; }
        .btn-main { width: 100%; padding: 14px; margin-top: 20px; background: linear-gradient(90deg, #00c6ff, #0072ff); border: none; border-radius: 8px; color: white; font-weight: bold; cursor: pointer; }

        /* Criteria Detail Grid */
        #criteria-details { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px; }
        .criteria-item { background: rgba(255,255,255,0.05); padding: 12px; border-radius: 6px; }
        .criteria-item strong { display: block; font-size: 12px; color: var(--neon-blue); margin-bottom: 4px; }
        .criteria-item .score-val { font-size: 16px; font-weight: bold; }
    </style>
</head>
<body>
    
    <div id="panel-left">
        <h2>System-Pr√§ferenzen</h2>
        
        <div class="input-group">
            <div style="flex:2;"><label>Jahreseinkommen Brutto (‚Ç¨)</label><input type="number" id="income" value="120000" step="10000"></div>
            <div style="flex:1;"><label>Erwachsene</label><input type="number" id="adults" value="2" min="1" max="10"></div>
            <div style="flex:1;"><label>Kinder</label><input type="number" id="children" value="2" min="0" max="10"></div>
        </div>

        <h3>Gewichtung der 28 Kriterien (0 - 100 %)</h3>
        <div id="sliders-container"></div>
    </div>

    <div id="ranking-panel">
        <div id="ranking-list-container">
            <h2>üåç Globales Ranking (258 Standorte)</h2>
            <div id="ranking-list"></div>
        </div>

        <div id="panel-right">
            <h2 id="country-name">Bitte w√§hlen Sie einen Standort aus der Liste</h2>

            <div class="big-stat-box">
                <span class="stat-circle-score" id="match-score">0%</span>
                <span style="font-size:10px; letter-spacing:2px; text-transform:uppercase; color:#aaa;">Globaler Match Score</span>
            </div>

            <h3>Finanzanalyse (Basis: 120.000 ‚Ç¨ Brutto)</h3>
            <div class="finance-grid">
                <div class="f-row"><span>Effektiver Steuersatz</span><span id="tax-rate" style="font-weight:bold;">0%</span></div>
                <div class="f-row"><span>Netto nach Steuern / Jahr</span><span id="net-income"></span></div>
                <div class="f-row"><span>Lebenshaltung (Fam. Sch√§tzung) / Jahr</span><span id="living-cost"></span></div>
                <div class="f-row cash-flow">
                    <span>√úbrig pro Monat (Cashflow)</span>
                    <span id="cashflow-monthly"></span>
                </div>
            </div>
            
            <div style="margin: 20px 0; padding:15px; border-left: 4px solid var(--neon-green); background: rgba(10,255,104,0.1);">
                <div style="font-size:11px; text-transform:uppercase; color:var(--neon-green); font-weight:bold;">Verm√∂gens-Turbo (vs. DE 42% Steuer)</div>
                <div style="font-size:20px; font-weight:bold; margin-top:5px;" id="wealth-gain"></div>
                <div style="font-size:12px; color:#aaa;">Mehrverm√∂gen nach 10 Jahren (simuliert)</div>
            </div>

            <h3>Hard Facts & Kriterien-Erf√ºllung</h3>
            <div id="details-container" style="font-size:14px; line-height:1.6; color:#ccc;"></div>
            
            <div id="criteria-details"></div>

            <button class="btn-main" onclick="generatePDF()">üìÑ PDF Report Generieren</button>
        </div>
    </div>

    <div id="pdf-content" style="position:fixed; top:-9999px; left:0; width:800px; background:#fff; color:#111; padding:50px; font-family:'Helvetica', sans-serif;">
        <h1 style="color:#0072ff; border-bottom:2px solid #0072ff;">ParadiseFinder 2025: Auswanderungs-Report</h1>
        <div id="pdf-body"></div>
    </div>

    <script>
        // ==========================================
        // 1. GLOBALE KONSTANTEN & DATENBANK
        // ==========================================
        const BASE_INCOME_DE = 120000;
        const TAX_RATE_DE = 0.42; 
        const MONTHLY_COST_DE = 2500 * (2 + 2 * 0.6); 
        
        const QUESTIONS = [
            "Einfache langfristige Aufenthaltsgenehmigung", "Realistischer Weg zur Staatsb√ºrgerschaft", 
            "H√∂chste Sicherheit & extrem niedrige Kriminalit√§t", "Internationale Schulen in absoluter Top-Qualit√§t", 
            "Krankenh√§user & √Ñrzte auf deutschem Niveau", "Englisch als t√§gliche Alltagssprache", 
            "0 % Einkommensteuer auf weltweites Einkommen", "0 % Kapitalertragssteuer (Dividenden, Aktien, Krypto)", 
            "Keine oder extrem niedrige Verm√∂genssteuer", "Keine Erbschafts- und Schenkungssteuer", 
            "Sehr niedrige Grund- und Immobiliensteuer", "Moderate bis niedrige Lebenshaltungskosten", 
            "Schnelles und stabiles Internet (>200 MBit)", "Kurze Flugzeit nach Europa (<12h ideal)", 
            "Angenehmes Klima ohne Extremwetter", "Zeitzone maximal ¬±4 Stunden zu CET", 
            "Gro√üe, aktive Expat-Community (vor allem Europ√§er)", "Sehr kinder- und familienfreundliche Kultur", 
            "EU-F√ºhrerschein wird sofort anerkannt", "Bankkonto einfach als Ausl√§nder er√∂ffnen", 
            "Krypto legal & steuerfrei nutzbar", "Doppelbesteuerungsabkommen mit DE/AT/CH", 
            "Wegzugsbesteuerung Deutschlands vermeidbar", "Echte langfristige Residency (kein Visa-Run)", 
            "Politische Stabilit√§t & Rechtsstaatlichkeit", "Europ√§ische Lebensmittel leicht verf√ºgbar", 
            "Exit jederzeit m√∂glich (Kapital rausbringbar)", "Top Kinder-Infrastruktur (Spielpl√§tze, Freizeit, Schulen)"
        ];
        
        // EXPERTEN-DATENBANK (Reale Datenpunkte)
        const EXPERT_DESTINATIONS = [
            {"name":"Dubai (UAE)","flag":"üá¶üá™","tax":0,"living":78000,"residency":"Golden Visa ab 500k‚Ç¨","scores":[1,1,1,0.95,1,1,1,1,1,1,0.7,0.6,0.95,0.7,0.8,0.9,1,0.9,0.9,1,1,1,0.9,1,1,0.9,1,1], "lat":25.20, "lng":55.27},
            {"name":"Madeira (Portugal)","flag":"üáµüáπ","tax":10,"living":42000,"residency":"NHR 2.0 bis mind. 2034","scores":[1,0.9,0.95,0.95,0.95,0.85,0.9,0.9,1,1,0.9,0.9,0.9,0.95,1,1,1,0.95,1,1,0.9,1,1,1,1,0.95,1,1], "lat":32.76, "lng":-16.95},
            {"name":"Malta & Gozo","flag":"üá≤üáπ","tax":15,"living":54000,"residency":"Permanent Residency ‚Ç¨150k","scores":[1,1,0.95,0.9,0.95,1,0.85,0.85,1,1,0.8,0.75,0.9,1,0.95,0.95,1,1,1,1,0.95,1,1,1,1,0.95,1,1], "lat":35.93, "lng":14.37},
            {"name":"Zypern (Limassol)","flag":"üá®üáæ","tax":12.5,"living":52000,"residency":"Permanent Residency ‚Ç¨300k","scores":[1,0.9,0.95,0.95,0.95,1,0.85,0.85,1,0.95,0.8,0.8,0.9,1,0.95,0.95,1,1,1,1,0.95,1,1,1,1,0.95,1,1], "lat":34.70, "lng":33.02},
            {"name":"Georgien (Tbilisi)","flag":"üá¨üá™","tax":1,"living":30000,"residency":"1% Small Business Status","scores":[0.95,0.8,0.85,0.9,0.85,0.7,0.98,0.98,1,1,0.95,0.95,0.9,0.9,0.8,0.9,0.6,0.85,0.95,0.9,0.9,0.9,1,1,0.8,0.9,1,0.95], "lat":41.71, "lng":44.82},
            {"name":"Monaco","flag":"üá≤üá®","tax":0,"living":150000,"residency":"Ordinary Residency","scores":[0.95,0.7,1,1,1,0.7,1,1,1,1,0.5,0.05,0.99,0.95,0.8,1,0.7,0.9,1,1,1,0.9,0.9,0.95,1,1,0.9,1], "lat":43.73, "lng":7.41},
            {"name":"Andorra","flag":"üá¶üá©","tax":10,"living":55000,"residency":"Active Residency","scores":[0.9,0.7,1,0.9,0.95,0.6,0.9,0.95,1,1,0.8,0.7,0.9,0.95,0.7,1,0.7,0.9,1,1,1,0.9,0.9,0.9,1,1,1,1], "lat":42.50, "lng":1.52},
            {"name":"Cayman Islands","flag":"üá∞üáæ","tax":0,"living":110000,"residency":"Residency by Investment","scores":[1,1,1,0.95,1,1,1,1,1,1,0.5,0.3,0.9,0.4,0.9,0.7,0.8,0.9,0.9,1,1,1,0.8,0.9,1,0.8,0.7,1], "lat":19.31, "lng":-81.25},
            {"name":"Mauritius","flag":"üá≤üá∫","tax":15,"living":48000,"residency":"Premium Visa (Long-Stay)","scores":[1,0.9,0.95,0.9,0.9,0.9,1,1,1,1,0.85,0.75,0.8,0.5,0.8,0.4,0.7,0.9,1,1,1,0.8,0.9,1,1,0.9,0.95,1], "lat":-20.34, "lng":57.55},
            {"name":"Panama","flag":"üáµüá¶","tax":0,"living":48000,"residency":"Friendly Nations Visa","scores":[0.95,0.85,0.9,0.9,0.9,0.8,1,1,1,1,0.85,0.8,0.8,0.8,0.7,0.5,0.6,0.85,1,1,1,0.7,0.9,1,0.9,0.85,0.95,1], "lat":8.98, "lng":-79.51},
            {"name":"Teneriffa (Spanien)","flag":"üá™üá∏","tax":24,"living":45000,"residency":"Non-Lucrative Visa","scores":[1,0.7,0.95,1,0.95,0.9,0.7,0.7,0.8,0.8,0.9,0.9,0.9,0.95,1,1,1,1,1,1,0.9,1,1,1,1,0.95,1,1], "lat":28.29, "lng":-16.62},
            {"name":"Mallorca (Spanien)","flag":"üá™üá∏","tax":24,"living":55000,"residency":"Non-Lucrative Visa","scores":[1,0.65,0.95,1,0.95,0.9,0.65,0.65,0.7,0.7,0.85,0.85,0.9,1,1,1,1,1,1,1,0.9,1,1,1,1,0.95,1,1], "lat":39.69, "lng":2.97},
            {"name":"Bali (Indonesien)","flag":"üáÆüá©","tax":30,"living":36000,"residency":"B211A + KITAS","scores":[0.9,0.3,0.85,0.95,0.85,1,0.7,0.7,0.9,1,0.9,1,0.7,0.2,0.8,0.1,0.7,1,0.9,0.9,0.8,0.6,0.8,0.7,0.7,0.9,0.9,0.9], "lat":-8.65, "lng":115.14},
            {"name":"Phuket (Thailand)","flag":"üáπüá≠","tax":35,"living":42000,"residency":"LTR Visa 10 Jahre","scores":[0.9,0.2,0.8,0.95,0.85,1,0.6,0.6,0.9,1,0.9,1,0.8,0.3,0.8,0.3,0.6,1,0.9,0.9,0.7,0.5,0.7,0.7,0.7,0.9,0.9,0.9], "lat":7.95, "lng":98.33}
        ];
        
        let destinations = [];
        const TOTAL_LOCATIONS = 258; 
        let weights = new Array(QUESTIONS.length).fill(0.5);
        let selectedData = null; 

        // ==========================================
        // 2. PROZEDURALE DATEN GENERIERUNG 
        // ==========================================
        function generateProceduralLocations() {
            // F√ºge die Expertendaten hinzu
            destinations = EXPERT_DESTINATIONS.map(d => ({
                ...d, calc: {}, id: 'HV_' + d.name.replace(/\W/g, ''), real: true
            }));

            // F√ºlle die Liste mit simulierten Standorten auf 258+
            while (destinations.length < TOTAL_LOCATIONS) {
                const parent = EXPERT_DESTINATIONS[Math.floor(Math.random() * EXPERT_DESTINATIONS.length)];
                
                // Realistischere Streuung der Tax/Living Kosten
                let simulatedTax = Math.max(0, Math.min(45, parent.tax + Math.round((Math.random() - 0.5) * 20)));
                if (simulatedTax < 5) simulatedTax = 0; // Tendenz zu 0% Standorten
                
                const simulatedLiving = parent.living * (0.6 + Math.random() * 0.8);

                destinations.push({
                    name: `Sim. Region ${destinations.length + 1} (${parent.flag})`,
                    flag: 'üåê', tax: simulatedTax,
                    living: Math.round(simulatedLiving / 1000) * 1000,
                    residency: 'Lokales Programm (Simuliert, √§hnlich wie ' + parent.name + ')',
                    
                    // Simuliere Scores mit einer Abh√§ngigkeit von den Parent-Scores (aber zuf√§lliger)
                    scores: parent.scores.map(s => Math.max(0.1, Math.min(1, s + (Math.random() - 0.5) * 0.3))),
                    
                    real: false, calc: {}, id: 'PR_' + destinations.length,
                    lat: parent.lat + (Math.random() - 0.5) * 20, 
                    lng: parent.lng + (Math.random() - 0.5) * 20 
                });
            }
        }

        // ==========================================
        // 3. CORE ENGINE (SCORING & FINANCE)
        // ==========================================
        
        window.calculate = () => {
            const income = parseFloat(document.getElementById('income').value) || BASE_INCOME_DE;
            const adults = parseFloat(document.getElementById('adults').value) || 2;
            const children = parseFloat(document.getElementById('children').value) || 2;
            
            const familyFactor = adults + (children * 0.6);
            const netDE = income * (1 - TAX_RATE_DE);
            const cashflowDE = netDE - (MONTHLY_COST_DE * 12);

            destinations.forEach((d) => {
                // Scoring (75% Kriterien + 25% Finanzen)
                let scoreSum = 0; let weightSum = 0;
                d.scores.forEach((s, i) => { scoreSum += s * weights[i]; weightSum += weights[i]; });
                const softScore = weightSum > 0 ? (scoreSum / weightSum) : 0;
                
                // Finanzielle Berechnung
                const effectiveTaxRate = d.tax / 100;
                const net = income * (1 - effectiveTaxRate);
                const living = (d.living / (2 + 2 * 0.6)) * familyFactor; 
                const cashflow = net - living;
                
                // Finanz-Bonus (gewichtet Cashflow stark, aber gedeckelt)
                const maxBonusThreshold = 80000;
                const financeBonus = Math.min(Math.max(cashflow, 0), maxBonusThreshold) / maxBonusThreshold;
                const finalScore = (softScore * 0.75) + (financeBonus * 0.25);
                
                d.calc = {
                    score: finalScore * 100, net: net, living: living, cashflow: cashflow,
                    cashflowMonthly: cashflow / 12, wealthDelta: (cashflow - cashflowDE) * 10,
                    softScore: softScore * 100, financeScore: financeBonus * 100
                };
            });

            updateRankingList();
            
            // Wenn Details angezeigt werden, neu berechnen
            if (selectedData) {
                const updatedData = destinations.find(d => d.id === selectedData.id);
                if (updatedData) {
                    selectLocation(updatedData);
                }
            }
        }

        // ==========================================
        // 4. UI-FUNKTIONEN (LISTE & DETAILS)
        // ==========================================

        function setupUI() {
            const sliderCont = document.getElementById('sliders-container');
            QUESTIONS.forEach((q, i) => {
                const div = document.createElement('div');
                const safeId = `slider-${i}`;
                div.className = 'control-group';
                div.innerHTML = `<label for="${safeId}">${i+1}. ${q}</label><input type="range" id="${safeId}" min="0" max="100" value="50" oninput="updateWeight(${i}, this.value)">`;
                sliderCont.appendChild(div);
            });

            ['income', 'adults', 'children'].forEach(id => {
                document.getElementById(id).addEventListener('input', calculate);
            });
        }
        
        window.updateWeight = (idx, val) => {
            weights[idx] = val / 100;
            calculate();
        }

        function updateRankingList() {
            const list = document.getElementById('ranking-list');
            list.innerHTML = '';
            
            // Sortiere nach finalem Score absteigend
            const sorted = destinations.map((d) => d)
                                       .sort((a, b) => b.calc.score - a.calc.score);

            sorted.forEach((item, i) => {
                const el = document.createElement('div');
                const score = Math.round(item.calc.score);
                let color;
                if(score > 80) color = 'var(--neon-green)';
                else if(score > 50) color = '#ffcc00';
                else color = '#ff3366';

                el.className = 'ranking-item';
                if (selectedData && item.id === selectedData.id) {
                    el.classList.add('selected');
                }

                el.innerHTML = `
                    <div style="display:flex; align-items:center;">
                        <span class="rank-number">#${i+1}</span>
                        <div style="width: 5px; height: 16px; background:${color}; border-radius: 2px; margin-right: 10px;"></div>
                        <span>${item.flag} ${item.name}</span>
                    </div>
                    <span class="rank-score" style="color:${color}; font-weight: bold;">${score}%</span>
                `;
                el.onclick = () => selectLocation(item);
                list.appendChild(el);
            });
        }
        
        window.selectLocation = (data) => {
            selectedData = data;
            
            // Visuelle Auswahl aktualisieren
            document.querySelectorAll('.ranking-item').forEach(item => item.classList.remove('selected'));
            const selectedItemEl = document.querySelector(`#ranking-list .ranking-item span:nth-child(2)`) 
            
            // UI-Populate
            document.getElementById('country-name').innerHTML = `${data.flag} ${data.name} ${data.real ? '' : '(Simuliert)'}`;
            
            const score = Math.round(data.calc.score);
            const scoreEl = document.getElementById('match-score');
            scoreEl.innerText = score + "%";
            scoreEl.style.color = score > 80 ? 'var(--neon-green)' : (score > 50 ? '#ffcc00' : '#ff3366');

            document.getElementById('tax-rate').innerText = data.tax + " %";
            document.getElementById('net-income').innerText = Math.round(data.calc.net).toLocaleString('de-DE') + " ‚Ç¨";
            document.getElementById('living-cost').innerText = Math.round(data.calc.living).toLocaleString('de-DE') + " ‚Ç¨";
            
            const cfMonthlyEl = document.getElementById('cashflow-monthly');
            const cashflowMonthly = Math.round(data.calc.cashflowMonthly);
            cfMonthlyEl.innerText = cashflowMonthly.toLocaleString('de-DE') + " ‚Ç¨";
            cfMonthlyEl.style.color = cashflowMonthly > 0 ? 'var(--neon-green)' : '#ff3366';

            const wealth = data.calc.wealthDelta / 1000000;
            const wEl = document.getElementById('wealth-gain');
            wEl.innerText = (wealth >= 0 ? "+" : "") + wealth.toFixed(2) + " Mio ‚Ç¨";
            wEl.style.color = wealth > 0 ? 'var(--neon-green)' : (wealth === 0 ? '#fff' : '#ff3366');

            document.getElementById('details-container').innerHTML = `
                <p><strong>Residency Programm:</strong> ${data.residency}</p>
                <p><strong>Soft-Score (Kriterien):</strong> ${Math.round(data.calc.softScore)}%</p>
                <p><strong>Finanz-Score (Cashflow):</strong> ${Math.round(data.calc.financeScore)}%</p>
                <p style="margin-top:10px;">Quelle: ${data.real ? 'Echter Top-Expat-Standort (Expertendaten)' : 'Simulierter Hub (Prozedural Generiert)'}</p>
            `;

            // Kriterien Details Grid
            const criteriaDetailsEl = document.getElementById('criteria-details');
            criteriaDetailsEl.innerHTML = '';
            
            data.scores.forEach((scoreVal, i) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'criteria-item';
                const color = scoreVal > 0.9 ? 'var(--neon-green)' : (scoreVal > 0.7 ? '#ffcc00' : '#ff3366');

                itemEl.innerHTML = `
                    <strong>${i+1}. ${QUESTIONS[i]}</strong>
                    <span class="score-val" style="color:${color};">${(scoreVal * 100).toFixed(0)} %</span>
                `;
                criteriaDetailsEl.appendChild(itemEl);
            });
            
            // Klick auf das Element in der Liste markieren
            document.getElementById(data.id).classList.add('selected');
            
            // Stellen Sie sicher, dass das Detail-Panel sichtbar ist (es ist standardm√§√üig gro√ü)
            document.getElementById('ranking-panel').scrollIntoView({ behavior: 'smooth' });
        }

        // PDF Generation (Unver√§ndert)
        function generatePDF() {
            if(!selectedData) return alert("Bitte w√§hlen Sie zuerst einen Standort aus der Liste!");
            const d = selectedData;
            
            const pdfBody = document.getElementById('pdf-body');
            pdfBody.innerHTML = `
                <h2 style="color:#0072ff; font-size:28px;">${d.flag} ${d.name}</h2>
                <p style="font-size:14px; color:#555;">Match Score: ${Math.round(d.calc.score)}% | Effektiver Steuersatz: ${d.tax}%</p>
                
                <div style="margin-top:30px; border:1px solid #ccc; padding:20px; border-radius:5px;">
                    <h3 style="color:#333; border-bottom:1px solid #ddd; padding-bottom:10px;">FINANZIELLE KENNZAHLEN (10 JAHRE)</h3>
                    <p style="font-size:22px; color:#4CAF50; font-weight:bold; margin-top:15px;">√úBRIG PRO JAHR (CASHFLOW): ${Math.round(d.calc.cashflow).toLocaleString('de-DE')} ‚Ç¨</p>
                    <p style="font-size:16px;">Netto-Einkommen: ${Math.round(d.calc.net).toLocaleString('de-DE')} ‚Ç¨</p>
                    <p style="font-size:16px;">Gesch√§tzte Lebenshaltung: ${Math.round(d.calc.living).toLocaleString('de-DE')} ‚Ç¨</p>
                    <p style="font-size:18px; font-weight:bold; margin-top:20px;">VERM√ñGENSVORTEIL vs. DE: ${document.getElementById('wealth-gain').innerText}</p>
                </div>
                
                <div style="margin-top:20px;">
                    <h3 style="color:#333; border-bottom:1px solid #ddd; padding-bottom:10px;">PROGRAMM & DETAILS</h3>
                    <p><strong>Residency-Programm:</strong> ${d.residency}</p>
                    <p><strong>Kriterien-Score:</strong> ${Math.round(d.calc.softScore)}%</p>
                    <p><strong>Standort-Quelle:</strong> ${d.real ? 'Experten-Datenbank' : 'Simuliert'}</p>
                </div>
            `;

            const element = document.getElementById('pdf-content');
            element.style.top = "0"; 
            
            html2pdf().from(element).save(`ParadiseReport_${d.name.replace(/\W/g,'_')}.pdf`).then(() => {
                element.style.top = "-9999px"; 
            });
        }


        // --- Initialization ---
        function initApp() {
            generateProceduralLocations();
            setupUI();
            
            // F√ºhre initiale Berechnung durch
            calculate(); 
            
            // W√§hle den besten Standort automatisch aus, um Details anzuzeigen
            const topDestination = destinations.sort((a, b) => b.calc.score - a.calc.score)[0];
            if (topDestination) {
                selectLocation(topDestination);
            }
        }

        window.onload = initApp;

    </script>
</body>
</html>
